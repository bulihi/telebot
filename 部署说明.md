# ğŸš€ Telegram Bot éƒ¨ç½²è¯´æ˜

## ç¯å¢ƒè¦æ±‚

- CentOS 7 æˆ–æ›´é«˜ç‰ˆæœ¬
- å®å¡”é¢æ¿
- Go 1.23.4 æˆ–æ›´é«˜ç‰ˆæœ¬
- SQLite3

## ä¸€ã€å®‰è£…å®å¡”é¢æ¿

1. ä½¿ç”¨SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
```

2. å®‰è£…å®Œæˆåï¼Œè®°å½•ä¸‹é¢æ¿åœ°å€å’Œç™»å½•ä¿¡æ¯ã€‚

## äºŒã€å®‰è£…å¿…è¦è½¯ä»¶

1. åœ¨å®å¡”é¢æ¿ä¸­å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
   - Nginx
   - SQLite3
   - Git

2. å®‰è£… Go ç¯å¢ƒï¼š

```bash
# ä¸‹è½½Go
wget https://golang.google.cn/dl/go1.23.4.linux-amd64.tar.gz

# è§£å‹åˆ° /usr/local
tar -C /usr/local -xzf go1.23.4.linux-amd64.tar.gz

# é…ç½®ç¯å¢ƒå˜é‡
echo 'export PATH=$PATH:/usr/local/go/bin' >> /etc/profile
source /etc/profile

# éªŒè¯å®‰è£…
go version
```

## ä¸‰ã€éƒ¨ç½²æœºå™¨äºº

1. åˆ›å»ºé¡¹ç›®ç›®å½•ï¼š

```bash
mkdir -p /www/wwwroot/telegram-bot
cd /www/wwwroot/telegram-bot
```

2. å…‹éš†ä»£ç ï¼š

```bash
git clone <ä½ çš„ä»“åº“åœ°å€> .
```

3. å®‰è£…ä¾èµ–ï¼š

```bash
go mod tidy
```

4. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cp config.yaml.example config.yaml
vim config.yaml
```

é…ç½®ç¤ºä¾‹ï¼š
```yaml
telegram:
  bot_token: "YOUR_BOT_TOKEN"
  admin_user_id: YOUR_ADMIN_ID

database:
  path: "/www/wwwroot/telegram-bot/bot.db"

server:
  port: ":8080"
  admin_password: "YOUR_ADMIN_PASSWORD"

proxy:
  enabled: true
  url: "socks5://127.0.0.1:1080"  # å¦‚æœéœ€è¦ä»£ç†

settings:
  default_action: "mute"
  mute_duration: 3600
  log_violations: true

groups:
  default_settings:
    welcome_message: "æ¬¢è¿ {user} åŠ å…¥ {group_name}..."
    verification:
      enabled: true
      question: "è¯·å›ç­”ï¼š1+1=?"
      answer: "2"
      timeout: 300
```

5. ç¼–è¯‘ç¨‹åºï¼š

```bash
go build -o telegrambot
```

## å››ã€é…ç½®å®ˆæŠ¤è¿›ç¨‹

1. åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
vim /etc/systemd/system/telegram-bot.service
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Unit]
Description=Telegram Bot Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/www/wwwroot/telegram-bot
ExecStart=/www/wwwroot/telegram-bot/telegram-bot
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

2. å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡è½½æœåŠ¡é…ç½®
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start telegram-bot

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable telegram-bot

# æŸ¥çœ‹çŠ¶æ€
systemctl status telegram-bot
```

## äº”ã€é…ç½®Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é€šè¿‡åŸŸåè®¿é—®Webç®¡ç†ç•Œé¢ï¼š

1. åœ¨å®å¡”é¢æ¿ä¸­æ·»åŠ ç«™ç‚¹
2. é…ç½®åå‘ä»£ç†ï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:8080;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

## å…­ã€å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
systemctl start telegram-bot

# åœæ­¢æœåŠ¡
systemctl stop telegram-bot

# é‡å¯æœåŠ¡
systemctl restart telegram-bot

# æŸ¥çœ‹æ—¥å¿—
journalctl -u telegram-bot -f

# æŸ¥çœ‹çŠ¶æ€
systemctl status telegram-bot
```

## ä¸ƒã€æ›´æ–°ç¨‹åº

1. æ‹‰å–æœ€æ–°ä»£ç ï¼š

```bash
cd /www/wwwroot/telegram-bot
git pull
```

2. é‡æ–°ç¼–è¯‘ï¼š

```bash
go build -o telegram-bot
```

3. é‡å¯æœåŠ¡ï¼š

```bash
systemctl restart telegram-bot
```

## å…«ã€æ•…éšœæ’æŸ¥

1. æ£€æŸ¥æ—¥å¿—ï¼š
```bash
journalctl -u telegram-bot -f
```

2. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼š
```bash
# æµ‹è¯•ç½‘ç»œ
./telegram-bot test-network
```

3. å¸¸è§é—®é¢˜ï¼š
   - å¦‚æœå‡ºç°ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæ£€æŸ¥ä»£ç†è®¾ç½®
   - å¦‚æœå‡ºç°æƒé™é—®é¢˜ï¼Œæ£€æŸ¥æ–‡ä»¶æƒé™
   - å¦‚æœå‡ºç°æ•°æ®åº“é”™è¯¯ï¼Œæ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™

## ä¹ã€å®‰å…¨å»ºè®®

1. æ›´æ”¹é»˜è®¤ç«¯å£
2. è®¾ç½®å¼ºå¯†ç 
3. é…ç½®é˜²ç«å¢™
4. å®šæœŸå¤‡ä»½æ•°æ®åº“
5. åŠæ—¶æ›´æ–°ç³»ç»Ÿå’Œä¾èµ–

## åã€å¤‡ä»½è¯´æ˜

1. æ•°æ®åº“å¤‡ä»½ï¼š
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /www/backup/telegram-bot

# å¤‡ä»½æ•°æ®åº“
cp /www/wwwroot/telegram-bot/bot.db /www/backup/telegram-bot/bot_$(date +%Y%m%d).db
```

2. é…ç½®æ–‡ä»¶å¤‡ä»½ï¼š
```bash
cp /www/wwwroot/telegram-bot/config.yaml /www/backup/telegram-bot/config_$(date +%Y%m%d).yaml
```

å»ºè®®è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨å¤‡ä»½ã€‚

## åä¸€ã€æ³¨æ„äº‹é¡¹

1. ç¡®ä¿æœåŠ¡å™¨æ—¶é—´å‡†ç¡®
2. å®šæœŸæ£€æŸ¥æ—¥å¿—
3. å®šæœŸæ¸…ç†æ—§æ—¥å¿—å’Œå¤‡ä»½
4. ä¿æŒç³»ç»Ÿå’Œä¾èµ–åŒ…æ›´æ–°
5. å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤ 